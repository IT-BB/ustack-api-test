# 25 文件存储

## 25.1 文件存储概述

文件存储是云平台提供的 NFS 文件服务器，可以与虚拟机实例和本地服务器搭配使用。文件存储提供了标准的 NFS 文件访问协议，协议版本为 NFSv4，支持 POSIX 文件接口。

用户在控制台创建文件存储实例后，只需在虚拟机实例中安装文件存储客户端，使用标准挂载命令挂载创建的文件系统，就可以轻松地在多个实例间共享文件。

## 25.2 创建文件存储

云平台用户可以通过指定计算集群、存储集群、容量、VPC、子网、外网IP、外网安全组、项目组、文件存储名称等相关基础信息创建文件存储。

可通过导航栏进入【文件存储】资源控制台，通过 “**创建**” 进入向导页面，如下图所示：

![createFS](../images/userguide/createFS.png)

1. 选择并配置文件存储的基础配置、网络设置及管理配置信息：

* 名称/备注：申请文件存储的名称和备注，申请时必须指定名称；
* 计算集群：支持选择计算集群，并展示所选计算集群的CPU和内存使用率；
* 存储集群：支持选择存储集群，并展示所选存储集群的存储用量；
* 容量：支持的容量范围为 100~64000 GB；
* VPC与子网：创建文件存储时必须选择 VPC 网络和所属子网，即选择要加入的网络及 IP 网段；
* 外网 IP ：为文件存储提供外网挂载服务，支持创建文件存储时申请并绑定一个外网 IP 作为外网挂载地址。平台目前仅支持 IPv4 网络，也可在文件存储创建成功后绑定外网 IP ，每个文件存储仅支持绑定一个外网IP。

2. 选择购买数量和付费方式，确认订单金额并点击“立即购买” 进行文件存储的创建：

- 购买数量：默认支持创建 1 个文件存储；
- 付费方式：选择文件存储的计费方式，支持按月、按年、按时三种方式，可根据需求选择合适的付费方式；
- 合计费用：用户选择文件存储资源按照付费方式的费用展示；
- 立即购买：点击立即购买后，会返回文件存储资源列表页，在列表页可查看文件存储的创建过程，通常会先显示“初始化”的状态，几秒内转换为“可用”状态，即代表创建成功。

### 25.2.1 Linux 机器挂载文件存储方法

用户可通过文件存储列表的内网/外网挂载地址挂载文件存储服务：

```
mkdir /datanfs
yum install -y nfs-utils
mount -t nfs4 192.168.179.179:/ /datanfs
```

### 25.2.2 Windows 机器挂载文件存储方法

用户可通过文件存储列表的内网/外网挂载地址,挂载或者卸载文件存储服务：

1、安装nfs：在控制面板找到nfs客户端和管理工具，点击安装，并等待一段时间

![fs-1](../images/userguide/fs-1.png)
![fs-2](../images/userguide/fs-2.png)
![fs-3](../images/userguide/fs-3.png)
![fs-4](../images/userguide/fs-4.png)

2、挂载目录：打开命令提示符，执行命令挂载目录

```
mount \\172.16.0.11\\data\nfs Y:
```
需要注意的是，Y是挂载的设备名，类似于C盘D盘，需要找一个没用过的字符来命名设备，\data\nfs 是一个固定路径，不需要修改

![fs-5](../images/userguide/fs-5.png)

3、查看挂载目录：打开命令提示符，执行命令查看目录

```
showmount -e 172.16.0.11
```

![fs-6](../images/userguide/fs-6.png)

![fs-7](../images/userguide/fs-7.png)

用户通过机器在此目录上传的文件，可以在云平台查看

![fs-8](../images/userguide/fs-8.png)

![fs-9](../images/userguide/fs-9.png)

![fs-10](../images/userguide/fs-10.png)

3、卸载目录：打开命令提示符，执行命令卸载目录

```
umount Y:
```

![fs-11](../images/userguide/fs-11.png)


## 25.3 文件存储列表

通过导航栏进入文件存储控制台，可查看文件存储资源列表。

文件存储列表可查看当前账户下所有文件存储资源的列表信息，包括名称、资源 ID、状态、存储容量、挂载地址、VPC、子网、计费方式、项目组、创建时间、过期时间及操作项，如下图所示：

![FSlist](../images/userguide/FSlist.png)

- 名称：文件存储资源的名称；
- 资源 ID：文件存储的资源ID作为全局唯一标识符；
- 状态：文件存储资源的状态，包括初始化、可用、删除中等状态；
- 集群：文件存储所属的计算集群；
- 存储类型：文件存储所属的存储集群；
- 存储容量：文件存储的内存容量，容量范围为 100~64000 GB；
- 挂载地址：可通过内网/外网挂载地址挂载文件存储服务；
- VPC/子网：文件存储创建时所指定的 VPC 网络和子网，即文件存储内网 IP 所在的 VPC 网络和子网信息；
- 计费方式：文件存储的付费方式，包括按时、按年、按月；
- 项目组：文件存储创建时所绑定的项目组；
- 标签：文件存储所绑定的标签；
- 创建时间/过期时间：文件存储资源的创建时间和费用过期时间；
- 操作：列表上的操作项是对单个文件存储的操作，包括文件管理、扩容、修改IP、绑定、解绑、续费及删除等。

## 25.4 查看文件存储详情

用户可通过点击列表的名称进入文件存储详情页，查看基本信息和监控信息。

- 基本信息包括：资源ID、文件存储名称、状态、存储容量、挂载地址、VPC、子网、安全组、计费类型、创建时间及过期时间；
- 监控信息包括：CPU使用率、内存使用率、存储容量、当前存储量、存储容量使用率、存储总写吞吐及存储总读吞吐。如下图所示：

![FSdetails](../images/userguide/FSdetails.png)

## 25.5 文件存储扩容

平台支持用户在线或者离线扩容文件存储的容量，适应于业务发生变化需扩容文件存储容量的场景。平台仅支持文件存储容量的扩容，不支持文件存储容量的缩容。

文件存储容量扩容范围即当前硬盘类型的规格，默认为 100GB~64000 GB。

扩容文件存储容量会对费用产生影响，按小时付费的硬盘，扩容容量下个付费周期按新配置扣费；按年按月付费的硬盘，扩容容量即时生效，并按比例自动补差价。用户可点击文件存储控制台操作中的 “**扩容**” 进行容量扩容操作，如下图所示：

![FSstorageup](../images/userguide/FSstorageup.png)

如图所示，**更改容量**，即文件存储需要扩容的容量。平台已展示当前文件存储的容量大小，由于不支持缩容，扩容时更改容量必须大于当前容量大小。用户可通过文件存储列表查看新容量。

## 25.6 绑定外网 IP

绑定外网 IP 是指将 EIP 地址绑定至文件存储，用户可通过外网挂载地址使用文件存储服务。

用户可通过文件存储资源列表操作项的 “**绑定**” 进入外网 IP 绑定向导页面，进行资源绑定操作，如下图所示：

![FSlinkeip](../images/userguide/FSlinkeip.png)

绑定时需选择被绑定的弹性IP，绑定成功后，文件存储列表的挂载地址会新增外网挂载地址。

## 25.7 解绑外网 IP

解绑外网 IP 是指将 EIP 地址从一个文件存储资源上分离出来，并可重新绑定至其它虚拟资源。仅支持解绑已绑定文件存储的外网 IP 资源，用户可通过文件存储资源列表操作项的 “**解绑**” 进入外网 IP 解绑向导页面，进行资源解绑操作，如下图所示：

![FSunlinkeip](../images/userguide/FSunlinkeip.png)

## 25.8 文件存储续费

支持用户手动对文件存储进行续费。

文件存储续费时支持更改续费方式，只可由短周期改为长周期，例如按月的续费方式可更改为按月、按年。

文件存储续费时会按照续费时长收取费用，续费时长与资源的计费方式相匹配，当文件存储的计费方式为【小时】，则续费时长可指定为 1 小时；当文件存储的计费方式为【按月】，则续费时长可选择 1 至 11 月；当文件存储的计费方式为【按年】，则续费时长为 1 至 5 年。可通过文件存储列表操作项中的 “**续费**” 进行操作，如下图所示：

![FSrenew](../images/userguide/FSrenew.png)

## 25.9 修改文件存储告警模板

用户可在控制台修改文件存储的告警模板。可通过文件存储列表操作项中的 “**修改告警模板**” 按钮进行操作，如下图所示：

![FSmodifyTemplate](../images/userguide/FSmodifyTemplate.png)

## 25.10 搜索文件存储

用户可通过搜索框对文件存储列表进行搜索和筛选，支持从名称、备注、资源ID、挂载地址进行模糊搜索，如下图所示：

![searchFS](../images/userguide/searchFS.png)

## 25.11 修改文件存储名称与备注

修改文件存储的名称和备注。可通过点击文件存储列表名称右侧的 “编辑” 按钮进行修改，如下图所示：

![modifyFSname](../images/userguide/modifyFSname.png)

## 25.12 修改IP

支持用户修改文件存储的内网IP地址。

![updatefsip](../images/userguide/updatefsip.png)

## 25.13 从备份创建

支持用户从备份创建新实例。

![createfsfrombak](../images/userguide/createfsfrombak.png)

## 25.14 删除文件存储

用户可在控制台删除账户内文件存储，支持对文件存储进行批量删除操作。可通过文件存储列表操作项中的 “**删除**” 进行操作，如下图所示：

![FSrm](../images/userguide/FSrm.png)

## 25.15 文件管理

支持用户查看文件存储中的文件，并进行管理操作，页面如下图所示：

![FSfile1](../images/userguide/FSfile1.png)

- **上传文件**：在“文件管理”分页，点击列表操作栏下的**“上传文件”**按钮，可以从本地上传文件，如下图所示：

![FSfile2](../images/userguide/FSfile2.png)

- **创建目录**：点击列表操作栏下的**“创建目录”**按钮，可以在文件管理页创建目录，如下图所示：

![FSfile3](../images/userguide/FSfile3.png)
注意：为确保在不同操作系统间共享文件时，文件名和内容能够正确显示，建议在 Windows 虚拟机上创建目录时使用英文字符。这有助于避免因不同平台使用不同字符集（如 Windows 使用 GBK，而 Linux 使用 UTF-8）导致的乱码问题。

- **下载文件**：点击文件后的”**下载**“按钮，可以将文件存储中的文件下载到本地，如下图所示：

  ![downloadfile1](../images/userguide/downloadfile1.png)
- **显示隐藏文件**："**勾选显示隐藏文件**“按钮，即可显示隐藏文件和文件夹，如下图所示：

  ![fsimage6](../images/userguide/fsimage6.png)
- **删除文件或目录**：点击文件列表的**“删除”**按钮，可删除对应的文件或目录，也支持批量删除，如下图所示：

![FSfile4](../images/userguide/FSfile4.png)

## 25.16 文件存储 删除保护

支持用户开启删除保护功能，用于防止文件存储产品被误删除释放，在创建时增加「删除保护」选项，如下图所示：

![fsview1](../images/userguide/fsview1.png)

删除资源时需要将此选项关闭才可以进行删除，如下图所示：

![fsview2](../images/userguide/fsview2.png)

## 25.17 文件存储 连接信息

支持展示文件存储产品客户端连接的网络信息，内网访问支持展示请求地址机器名称，外网仅支持展示请求地址，如下图所示：

![fsview3](../images/userguide/fsview3.png)

## 25.18 文件存储 开机关机

文件存储 支持实例开关机操作，便于用户做离线配置升降级等操作，如下图所示：

![fsview4](../images/userguide/fsview4.png)

![fsview5](../images/userguide/fsview5.png)

注意事项：
* 文件存储的备份任务非可用状态，文件存储无法关机
* 文件存储的备份任务是可用状态，文件存储关机，定时备份计划会自动暂停，开机后会自动恢复






